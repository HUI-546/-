<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>待办事项</title>

     <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html,body{
            height: 100%;
            overflow: hidden;
        }
        body{
            margin: 20px;
            font-family: monospace;
            padding-top: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;

        }
        .container{
            max-width: 800px;
            width: 100%;
            padding: 25px;
            background-color: rgb(207, 244, 250);
            border-radius: 20px;
            height: 85vh;
            max-height: 700px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }
        .container h1{
            text-align: center;
            margin-bottom: 20px;
            color: rgb(49, 174, 232);
            flex-shrink: 0;
        }
        .add-todo{
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-shrink: 0;

        }
        #todo-input{
            flex: 1;
            width: 80%;
            padding: 0 20px;
            text-align: center;
            border: 2px solid  rgb(140, 219, 231);
            font-size: 16px;
            border-radius: 30px;
            height: 40px;

        }
        #todo-input:focus{
            border-color:  rgb(19, 168, 192);
            outline: none;
        }
        #add-btn{
            min-width: 80px;
            height: 40px;
            margin: auto 0;
            background-color:  rgb(150, 232, 246);;
            border-radius: 10px;
            color: #007890;
            border: none;
            cursor: pointer;
        }
        #add-btn:hover{
            border: 1px solid #0095a2;
            background-color: rgb(113, 229, 247);
        }
        .filter-button{
            display: flex;
            justify-content: end;
            gap: 10px;
            margin-right: 10px;
            margin-bottom: 15PX;
        }
        .filter-button button{
            padding: 3px;
            border-radius: 10px;
            background-color:  rgb(199, 235, 252);
            border: 2px solid  rgb(246, 253, 254);
            color: #6e8890;
            font-size: 11px;
            
        }
        .filter-button button:hover{
            transform: scale(1.2);
            background-color: rgb(183, 232, 255);
        }
        .task-count{
            text-align: end;
            font-size: 14px;
            color: rgb(72, 102, 115);;
        }
        #todo-list{
            flex: 1;
            margin: 5px 0;
            overflow-y: scroll;
            padding:0 5px;
            min-height: 300px;
            scrollbar-width: thin;
            scrollbar-color:  rgb(146, 207, 235)transparent;
        }
        .empty-message{
            height: 100%;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background-color: rgb(163, 234, 255);
            font-size: 26px;
            color:rgb(0, 139, 204);
        }
        #todo-list:not(:empty){
            padding-bottom: 10px;
        }
        .todo-item{
            display: flex;
            justify-content: space-between;
            gap: 10px;
            padding: 10px;
            min-height: 50px;
            text-align: center;
            background-color: rgb(163, 234, 255);
            margin: 5px 0;
            align-items: center;

        }
        .task-checkbox{
            width: 20px;
            margin-top: 0;
        }
        .todo-text{
            text-align: left;
            flex:1;
            font-size: 15px;
            line-height: 1.4;
            padding: 5px 0;
            word-break: break-all;

        }

        .edit-input{
            text-align: left;
            padding: 0 10px;

        }
        .edit-input:focus{
            border: 2px solid rgb(18, 171, 217);
            outline: none;
        }
         .edit-btn,.delete-btn{
            height: 28px;
            min-width: 30px;
            width: auto;
            border: 1px solid rgb(4, 181, 239);;
            border-radius: 10px;
            background-color: rgb(107, 208, 239);
            font-size: 10px;
            margin: auto;
            cursor: pointer;
        }
         .edit-btn:hover,.delete-btn:hover{
            background-color: rgb(203, 235, 245);
         }


        

     </style>
</head>
<body>
    <div class="container">
        <h1>待办事项+编辑+储存</h1>
        <div class="add-todo">
            <input type="text" id="todo-input" placeholder="内容输入框">
            <button id="add-btn">添加</button>
        </div>
        <div class="filter-button">
            <button onclick="filterTask('all')">全部</button>
            <button onclick="filterTask('completed')">完成</button>
            <button onclick="filterTask('active')">未完成</button>
        </div>
        <div class="task-count" id="task-count">全部:0|完成:0|未完成:0</div>
       <div id="todo-list">
        <p class="empty-message">暂未添加任何事项，请先添加</p>
       </div>
    </div>
    <script>
        let todos = JSON.parse(localStorage.getItem('todos')) ;
        todos = Array.isArray(todos) ? todos : [];
        
        function saveToLocalStorage(){
            localStorage.setItem('todos',JSON.stringify(todos))
        }

    function editTodos(taskId){
        const taskItem = document.querySelector(`.todo-item[data-id="${taskId}"]`);
        if(!taskItem)return
        const textElement = taskItem.querySelector('.todo-text');
        const currentText = textElement.textContent;

        const input = document.createElement('input')
        input.type='text';
        input.value=currentText;
        input.className='edit-input';
        input.style.height='31px';
        input.style.flex='1';
        input.style.border='none';


        textElement.parentNode.replaceChild(input,textElement)
        input.focus();

        input.addEventListener('keypress',function(e){
            if(e.key==='Enter'){
                const newText = input.value.trim();
                if(newText){
                    const todo = todos.find(todo => todo.id === taskId);
                    if (todo){
                        todo.text = newText;
                        saveToLocalStorage()
                        displayTodos();
                    } 
                }else{
                    textElement.parentNode.replaceChild(textElement,input);
                }
            }
        })
        input.addEventListener('blur',function(){
            const newText = input.value.trim()
            if(newText){
                const todo = todos.find(todo => todo.id===taskId)
                if(todo){
                    todo.text=newText;
                    saveToLocalStorage();
                    displayTodos();
                }
            }else{
                textElement.parentNode.replaceChild(textElement,input)
            }
        })
    }

    const todoInput = document.getElementById('todo-input');
    const addBtn = document.getElementById('add-btn');
    const todoList = document.getElementById('todo-list');

    function addTodos (){
        const text = todoInput.value.trim();
        if(text===''){
            alert('请先填写内容');
            return;
        }
        const newTodo = {
            id:Date.now(),
            text:text,
            completed:false
        }
        todos.push(newTodo);
        todoInput.value='';
        saveToLocalStorage()
        displayTodos();
    }

    function displayTodos(taskToShow){
        const showTodo = taskToShow || todos;
        if(showTodo.length===0){
            todoList.innerHTML='<p class="empty-message">暂无事项，请添加</p>';
            updateTaskCount();
            return;
        }
        let html = '' ;
        showTodo.forEach((todo,index) => {
            html += `
               <div class="todo-item ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
                  <input type="checkbox" class="task-checkbox" ${todo.completed ? 'checked' : ''}>
                  <span class="todo-text">${todo.text}</span>
                   
                      <button class="edit-btn" onclick="editTodos(${todo.id})" data-id="${todo.id}">编辑</button>
                      <button class="delete-btn" data-id="${todo.id}">删除</button>
         
               </div>

            `
        })
        todoList.innerHTML = html;
        updateTaskCount();
    }
    function toggleTaskCompletion(taskId){
        const task = todos.find(todo => todo.id == taskId)
        if(task){
          task.completed = !task.completed;
          saveToLocalStorage();
          displayTodos();
    }}
    function filterTask(filterType){
        let filteredTask = todos;
        if(filterType==='completed'){
            filteredTask = todos.filter(todo => todo.completed)
        }else if(filterType==='active'){
            filteredTask = todos.filter(todo => !todo.completed)
        }
        displayTodos(filteredTask);
    }
    function updateTaskCount(){
        const totalCount = todos.length;
        const completedCount = todos.filter(todo => todo.completed).length;
        const activeCount = todos.filter(todo => !todo.completed).length

        document.getElementById('task-count').textContent=
        `全部:${totalCount}| 完成:${completedCount} | 未完成:${activeCount}`
    }
    displayTodos();

    addBtn.addEventListener('click',addTodos);
    todoInput.addEventListener('keypress',function(e){
        if(e.key==='Enter'){
            addTodos();
        }
    })
    todoList.addEventListener('click',function(a){
        const taskItem = a.target.closest('.todo-item');
        if(!taskItem)return;
        const taskId = taskItem.dataset.id;
        if(a.target.classList.contains('delete-btn')){
          if(confirm('确认删除吗？')){
            todos = todos.filter(todo => todo.id != taskId)
            saveToLocalStorage();
            displayTodos();
          }
        }
        if(a.target.classList.contains('task-checkbox')){
            toggleTaskCompletion(taskId)
        }
    })

    </script>
</body>
</html>